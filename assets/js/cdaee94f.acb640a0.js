"use strict";(globalThis.webpackChunkai_robotics_textbook=globalThis.webpackChunkai_robotics_textbook||[]).push([[1336],{3772:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"module-2/ros2-in-depth","title":"ROS 2 in Depth: Nodes, Topics, Services, Actions","description":"Explore the core ROS 2 communication concepts of nodes, topics, services, and actions in depth.","source":"@site/docs/module-2/07-ros2-in-depth.md","sourceDirName":"module-2","slug":"/module-2/ros2-in-depth","permalink":"/hackathon_spec_kit_book/docs/module-2/ros2-in-depth","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"ros2","permalink":"/hackathon_spec_kit_book/docs/tags/ros-2"},{"inline":true,"label":"nodes","permalink":"/hackathon_spec_kit_book/docs/tags/nodes"},{"inline":true,"label":"topics","permalink":"/hackathon_spec_kit_book/docs/tags/topics"},{"inline":true,"label":"services","permalink":"/hackathon_spec_kit_book/docs/tags/services"},{"inline":true,"label":"actions","permalink":"/hackathon_spec_kit_book/docs/tags/actions"},{"inline":true,"label":"communication","permalink":"/hackathon_spec_kit_book/docs/tags/communication"}],"version":"current","lastUpdatedAt":1765144290000,"sidebarPosition":7,"frontMatter":{"title":"ROS 2 in Depth: Nodes, Topics, Services, Actions","slug":"ros2-in-depth","sidebar_position":7,"description":"Explore the core ROS 2 communication concepts of nodes, topics, services, and actions in depth.","tags":["ros2","nodes","topics","services","actions","communication"]},"sidebar":"tutorialSidebar","previous":{"title":"Linear Algebra & Calculus for Robot Motion","permalink":"/hackathon_spec_kit_book/docs/module-1/linear-algebra-calculus"},"next":{"title":"Building Robot Applications with ROS Packages","permalink":"/hackathon_spec_kit_book/docs/module-2/building-ros-applications"}}');var o=s(4848),r=s(8453);const t={title:"ROS 2 in Depth: Nodes, Topics, Services, Actions",slug:"ros2-in-depth",sidebar_position:7,description:"Explore the core ROS 2 communication concepts of nodes, topics, services, and actions in depth.",tags:["ros2","nodes","topics","services","actions","communication"]},c=void 0,a={},l=[{value:"Summary",id:"summary",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"ROS 2 Nodes: The Building Blocks",id:"ros-2-nodes-the-building-blocks",level:2},{value:"Defining and Launching Nodes",id:"defining-and-launching-nodes",level:3},{value:"Node Lifecycle and Callbacks",id:"node-lifecycle-and-callbacks",level:3},{value:"ROS 2 Topics: Publish-Subscribe Communication",id:"ros-2-topics-publish-subscribe-communication",level:2},{value:"Defining Topics and Messages",id:"defining-topics-and-messages",level:3},{value:"Subscribing to Topics",id:"subscribing-to-topics",level:3},{value:"Topic Quality of Service (QoS)",id:"topic-quality-of-service-qos",level:3},{value:"ROS 2 Services: Request-Response Communication",id:"ros-2-services-request-response-communication",level:2},{value:"Defining Services and Messages",id:"defining-services-and-messages",level:3},{value:"ROS 2 Actions: Complex, Long-Running Tasks",id:"ros-2-actions-complex-long-running-tasks",level:2},{value:"Defining Actions and Messages",id:"defining-actions-and-messages",level:3},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Glossary",id:"glossary",level:2},{value:"Review Questions",id:"review-questions",level:2}];function d(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(n.p,{children:"This chapter provides a comprehensive exploration of the core communication concepts in ROS 2: nodes, topics, services, and actions. You will learn how to design and implement robust ROS 2 systems by understanding the role and implementation of each of these key building blocks. Through practical coding examples and system architecture diagrams, you will gain the knowledge to create scalable, modular, and fault-tolerant robotic applications using the powerful ROS 2 framework."}),"\n",(0,o.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,o.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Explain the purpose and functionality of ROS 2 nodes, topics, services, and actions"}),"\n",(0,o.jsx)(n.li,{children:"Implement a ROS 2 publisher node that sends sensor data at 10 Hz"}),"\n",(0,o.jsx)(n.li,{children:"Analyze the communication flow in a ROS 2 system with multiple nodes, topics, and services"}),"\n",(0,o.jsx)(n.li,{children:"Evaluate the trade-offs between using topics, services, and actions for different robotic use cases"}),"\n",(0,o.jsx)(n.li,{children:"Create a ROS 2 action server and client to execute complex, long-running tasks"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Basic understanding of ROS 2 concepts and setup (covered in previous chapters)"}),"\n",(0,o.jsx)(n.li,{children:"Familiarity with Python programming and object-oriented design"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"ros-2-nodes-the-building-blocks",children:"ROS 2 Nodes: The Building Blocks"}),"\n",(0,o.jsx)(n.p,{children:"ROS 2 nodes are the fundamental building blocks of a robotic system. A node is a standalone process that performs a specific function, such as reading sensor data, processing information, or controlling a robot's actuators. Nodes communicate with each other using various ROS 2 communication primitives, which we'll explore in the following sections."}),"\n",(0,o.jsx)(n.h3,{id:"defining-and-launching-nodes",children:"Defining and Launching Nodes"}),"\n",(0,o.jsxs)(n.p,{children:["To create a ROS 2 node, you'll need to define a Python script that inherits from the ",(0,o.jsx)(n.code,{children:"rclpy.Node"})," class. This class provides the necessary methods and attributes to manage the node's lifecycle, handle callbacks, and interact with other ROS 2 entities."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MyNode(Node):\r\n    def __init__(self):\r\n        super().__init__('my_node')\r\n        # Node initialization code here\r\n\r\ndef main():\r\n    rclpy.init()\r\n    node = MyNode()\r\n    rclpy.spin(node)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"Use meaningful names for your nodes to help with debugging and maintainability. The name should describe the node's primary function."})}),"\n",(0,o.jsxs)(n.p,{children:["To launch a ROS 2 node, you can use the ",(0,o.jsx)(n.code,{children:"ros2 run"})," command in your terminal:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ros2 run my_package my_node\n"})}),"\n",(0,o.jsx)(n.h3,{id:"node-lifecycle-and-callbacks",children:"Node Lifecycle and Callbacks"}),"\n",(0,o.jsx)(n.p,{children:"ROS 2 nodes have a well-defined lifecycle, with the following key stages:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Initialization"}),": The node is created and any necessary setup is performed."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Spinning"}),": The node enters the event loop, where it can handle callbacks and process data."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Shutdown"}),": The node is gracefully terminated and any necessary cleanup is executed."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Nodes can define custom callbacks to handle various events, such as:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Timer callbacks"}),": Executed at a specified frequency, useful for periodic tasks."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Subscription callbacks"}),": Triggered when a message is received on a topic."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Service callbacks"}),": Invoked when a client requests a service."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Action callbacks"}),": Used to handle the various stages of an action execution."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"By leveraging these callbacks, you can create complex, event-driven robotic systems in ROS 2."}),"\n",(0,o.jsx)(n.h2,{id:"ros-2-topics-publish-subscribe-communication",children:"ROS 2 Topics: Publish-Subscribe Communication"}),"\n",(0,o.jsx)(n.p,{children:"ROS 2 topics are the primary means of asynchronous, one-to-many communication between nodes. A node can publish messages to a topic, and other nodes can subscribe to that topic to receive the data."}),"\n",(0,o.jsx)(n.h3,{id:"defining-topics-and-messages",children:"Defining Topics and Messages"}),"\n",(0,o.jsxs)(n.p,{children:["To use a topic, you'll need to define a message type that describes the data being transmitted. ROS 2 provides a wide range of built-in message types, and you can also create custom message types using the ",(0,o.jsx)(n.code,{children:".msg"})," file format."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from geometry_msgs.msg import Twist\r\n\r\nclass TurtleBot(Node):\r\n    def __init__(self):\r\n        super().__init__('turtlebot')\r\n        self.publisher_ = self.create_publisher(Twist, 'cmd_vel', 10)\r\n        self.timer = self.create_timer(0.1, self.timer_callback)\r\n\r\n    def timer_callback(self):\r\n        msg = Twist()\r\n        msg.linear.x = 0.1\r\n        msg.angular.z = 0.1\r\n        self.publisher_.publish(msg)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the ",(0,o.jsx)(n.code,{children:"TurtleBot"})," node publishes ",(0,o.jsx)(n.code,{children:"Twist"})," messages to the ",(0,o.jsx)(n.code,{children:"cmd_vel"})," topic at a rate of 10 Hz."]}),"\n",(0,o.jsx)(n.h3,{id:"subscribing-to-topics",children:"Subscribing to Topics"}),"\n",(0,o.jsx)(n.p,{children:"To receive data from a topic, you'll need to create a subscriber node and define a callback function to handle the incoming messages."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from sensor_msgs.msg import LaserScan\r\n\r\nclass LaserScanSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('laser_scan_subscriber')\r\n        self.subscription = self.create_subscription(\r\n            LaserScan,\r\n            'scan',\r\n            self.laser_scan_callback,\r\n            10)\r\n\r\n    def laser_scan_callback(self, msg):\r\n        print(f'Received laser scan data: {msg}')\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This ",(0,o.jsx)(n.code,{children:"LaserScanSubscriber"})," node subscribes to the ",(0,o.jsx)(n.code,{children:"scan"})," topic and prints the received ",(0,o.jsx)(n.code,{children:"LaserScan"})," messages."]}),"\n",(0,o.jsx)(n.h3,{id:"topic-quality-of-service-qos",children:"Topic Quality of Service (QoS)"}),"\n",(0,o.jsx)(n.p,{children:"ROS 2 topics support various Quality of Service (QoS) policies that allow you to fine-tune the communication behavior based on your application's needs. These policies include:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Reliability"}),": Determines whether messages should be delivered reliably or with best-effort."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Durability"}),": Specifies whether messages should be stored for late-joining subscribers."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"History"}),": Controls how many messages should be stored for late-joining subscribers."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You can configure the QoS policies when creating publishers and subscribers."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"self.publisher_ = self.create_publisher(Twist, 'cmd_vel', 10, qos_profile=QoSProfile(\r\n    reliability=QoSReliabilityPolicy.RELIABLE,\r\n    durability=QoSDurabilityPolicy.TRANSIENT_LOCAL,\r\n    history=QoSHistoryPolicy.KEEP_LAST,\r\n    depth=10\r\n))\n"})}),"\n",(0,o.jsx)(n.p,{children:"By understanding and leveraging QoS policies, you can create more robust and scalable ROS 2 systems."}),"\n",(0,o.jsx)(n.h2,{id:"ros-2-services-request-response-communication",children:"ROS 2 Services: Request-Response Communication"}),"\n",(0,o.jsx)(n.p,{children:"ROS 2 services provide a synchronous, request-response communication mechanism between nodes. A node can offer a service, and other nodes can request that service by sending a request message and waiting for a response."}),"\n",(0,o.jsx)(n.h3,{id:"defining-services-and-messages",children:"Defining Services and Messages"}),"\n",(0,o.jsxs)(n.p,{children:["Services are defined using ",(0,o.jsx)(n.code,{children:".srv"})," files, which specify the request and response message types."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# my_srv/srv/AddTwoInts.srv\r\nint64 a\r\nint64 b\r\n---\r\nint64 sum\n"})}),"\n",(0,o.jsx)(n.p,{children:"In your Python code, you can create a service server and client using the generated message types."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from my_srv.srv import AddTwoInts\r\n\r\nclass AddTwoIntsServer(Node):\r\n    def __init__(self):\r\n        super().__init__('add_two_ints_server')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        return response\r\n\r\nclass AddTwoIntsClient(Node):\r\n    def __init__(self):\r\n        super().__init__('add_two_ints_client')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n        self.request = AddTwoInts.Request()\r\n\r\n    def send_request(self):\r\n        self.request.a = 2\r\n        self.request.b = 3\r\n        self.future = self.cli.call_async(self.request)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the ",(0,o.jsx)(n.code,{children:"AddTwoIntsServer"})," node offers the ",(0,o.jsx)(n.code,{children:"add_two_ints"})," service, while the ",(0,o.jsx)(n.code,{children:"AddTwoIntsClient"})," node sends a request to the server and waits for the response."]}),"\n",(0,o.jsx)(n.h2,{id:"ros-2-actions-complex-long-running-tasks",children:"ROS 2 Actions: Complex, Long-Running Tasks"}),"\n",(0,o.jsx)(n.p,{children:"ROS 2 actions provide a higher-level communication mechanism for executing complex, long-running tasks. Actions are similar to services, but they support additional functionality, such as cancellation, progress feedback, and result reporting."}),"\n",(0,o.jsx)(n.h3,{id:"defining-actions-and-messages",children:"Defining Actions and Messages"}),"\n",(0,o.jsxs)(n.p,{children:["Actions are defined using ",(0,o.jsx)(n.code,{children:".action"})," files, which specify the goal, result, and feedback message types."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# my_action/action/MoveRobot.action\r\n# Goal\r\ngeometry_msgs/Pose target_pose\r\n---\r\n# Result\r\nbool success\r\n---\r\n# Feedback\r\nfloat32 distance_remaining\n"})}),"\n",(0,o.jsx)(n.p,{children:"In your Python code, you can create an action server and client using the generated message types."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from my_action.action import MoveRobot\r\n\r\nclass MoveRobotActionServer(Node):\r\n    def __init__(self):\r\n        super().__init__('move_robot_action_server')\r\n        self.action_server = ActionServer(\r\n            self,\r\n            MoveRobot,\r\n            'move_robot',\r\n            self.execute_callback)\r\n\r\n    def execute_callback(self, goal_handle):\r\n        # Implement the long-running task here\r\n        feedback = MoveRobot.Feedback()\r\n        feedback.distance_remaining = 1.0\r\n        goal_handle.publish_feedback(feedback)\r\n\r\n        result = MoveRobot.Result()\r\n        result.success = True\r\n        return result\r\n\r\nclass MoveRobotActionClient(Node):\r\n    def __init__(self):\r\n        super().__init__('move_robot_action_client')\r\n        self.action_client = ActionClient(self, MoveRobot, 'move_robot')\r\n\r\n    def send_goal(self):\r\n        goal_msg = MoveRobot.Goal()\r\n        goal_msg.target_pose.position.x = 2.0\r\n        goal_msg.target_pose.position.y = 3.0\r\n        self.action_client.send_goal_async(goal_msg, feedback_callback=self.feedback_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        print(f'Feedback received: {feedback_msg.feedback.distance_remaining}')\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the ",(0,o.jsx)(n.code,{children:"MoveRobotActionServer"}),' node implements a long-running "move robot" task, while the ',(0,o.jsx)(n.code,{children:"MoveRobotActionClient"})," node sends a goal to the server and receives progress feedback."]}),"\n",(0,o.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"ROS 2 nodes are the fundamental building blocks of a robotic system, responsible for specific functionalities."}),"\n",(0,o.jsx)(n.li,{children:"ROS 2 topics enable asynchronous, one-to-many communication using the publish-subscribe pattern."}),"\n",(0,o.jsx)(n.li,{children:"ROS 2 services provide synchronous, request-response communication between nodes."}),"\n",(0,o.jsx)(n.li,{children:"ROS 2 actions support complex, long-running tasks with additional features like cancellation and progress feedback."}),"\n",(0,o.jsx)(n.li,{children:"Understanding the strengths and trade-offs of each ROS 2 communication primitive is crucial for designing robust and scalable robotic applications."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"glossary",children:"Glossary"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Node"}),": A standalone process in a ROS 2 system that performs a specific function."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Topic"}),": A named bus over which nodes exchange messages using the publish-subscribe pattern."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Service"}),": A synchronous request-response communication mechanism between nodes."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Action"}),": A higher-level communication mechanism for executing complex, long-running tasks."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Quality of Service (QoS)"}),": Policies that control the behavior of ROS 2 communication primitives."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Callback"}),": A function that is executed in response to a specific event or message."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"review-questions",children:"Review Questions"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Explain the purpose and functionality of ROS 2 nodes, topics, services, and actions."}),"\n",(0,o.jsx)(n.li,{children:"Implement a ROS 2 publisher node that sends sensor data at 10 Hz. Describe the key steps involved."}),"\n",(0,o.jsx)(n.li,{children:"Analyze the communication flow in a ROS 2 system with multiple nodes, topics, and services. Identify the advantages and disadvantages of each communication primitive."}),"\n",(0,o.jsx)(n.li,{children:"Evaluate the trade-offs between using topics, services, and actions for different robotic use cases. Provide specific examples."}),"\n",(0,o.jsx)(n.li,{children:"Create a ROS 2 action server and client to execute a complex, long-running task. Explain how the action mechanism differs from using a service."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var i=s(6540);const o={},r=i.createContext(o);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);